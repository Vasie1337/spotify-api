<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Your Genres - Spotify Stats</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div class="container">
        <div class="row mt-4">
            <div class="col-12">
                <a href="index.html" class="btn btn-outline-success mb-4">‚Üê Back</a>
                <h1 class="text-center mb-4">Your Top Genres</h1>
                <div id="genres-container"></div>
            </div>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/script.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            const genresContainer = document.getElementById('genres-container');

            async function displayGenres() {
                try {
                    const data = await makeSpotifyRequest('/me/top/artists?limit=50&time_range=short_term');
                    
                    const genreCounts = {};
                    data.items.forEach(artist => {
                        artist.genres.forEach(genre => {
                            genreCounts[genre] = (genreCounts[genre] || 0) + 1;
                        });
                    });

                    const sortedGenres = Object.entries(genreCounts)
                        .sort(([,a], [,b]) => b - a)
                        .slice(0, 20);

                    const maxCount = Math.max(...sortedGenres.map(([,count]) => count));

                    genresContainer.innerHTML = sortedGenres.map(([genre, count], index) => `
                        <div class="genre-item mb-3">
                            <div class="d-flex justify-content-between mb-1">
                                <span class="genre-name">${index + 1}. ${genre}</span>
                                <span class="genre-count">${count} artists</span>
                            </div>
                            <div class="progress">
                                <div class="progress-bar bg-success" role="progressbar" 
                                    style="width: ${(count / maxCount) * 100}%"></div>
                            </div>
                        </div>
                    `).join('');
                } catch (error) {
                    console.error('Error fetching genres:', error);
                    window.location.href = 'index.html';
                }
            }

            displayGenres();
        });
    </script>
</body>
</html>
